\documentclass[a4paper]{scrreprt}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{vhistory, hyperref, listings, fullpage, enumitem, xcolor, bera}

\setlist[enumerate]{format=\bfseries\itshape, leftmargin=3em}
\setlist[enumerate,2]{leftmargin=4em}
\setlist[enumerate,1]{format=\bfseries,leftmargin=2em}

\interlinepenalty 10000

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{F8F8F8}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    framesep=0pt,
    framextopmargin=4pt,
    framexbottommargin=4pt,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

\lstset{
   language=json
}


\title{Amelie JSON-RPC API Specification}

\author{I.C.T.S.V. Inter-\emph{Actief}}

\date{\today}


\begin{document}
\maketitle

\begin{versionhistory}
  \vhEntry{0.1}{2014/07/13}{vollenbrockjhj}{basic structure, auth module, news module}
  \vhEntry{0.2}{2014/07/14}{vollenbrockjhj}{news, narrowcast, and committee module}
  \vhEntry{0.3}{2014/07/14}{vollenbrockjhj}{company module and activity module}
  \vhEntry{0.4}{2014/07/15}{vollenbrockjhj}{typography, layout, document style}
  \vhEntry{0.5}{2016/11/20}{albertskja}{Added Narrowcast.getHistoricActivitiesWithPictures and added optional
  parameter to getNews}
  \vhEntry{0.6}{2016/11/30}{boerpb}{property naming convention, restaurant and dish activity option properties}
  \vhEntry{0.7}{2016/11/30}{boerpb}{added listing of additional return properties of getActivityStream}
  \vhEntry{0.8}{2016/12/14}{boerpb}{authentication and preview mode descriptions revised}
  \vhEntry{0.9}{2016/12/14}{boerpb}{person and push module}
  \vhEntry{1.0}{2016/12/17}{boerpb}{education module, transaction module, naming consistency in company module, localization, authentication scopes}
\end{versionhistory}

\tableofcontents


\chapter{Introduction}
This document describes the jsonrpc application programming interface of amelie, the administration system of I.C.T.S.V. Inter-/Actief/. It should guide you through the different exposed entities and provide basic pointers to help you to enable your application to consume this data from amelie.\\

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.

\section{Endpoints}
The current version of the API (codename lennart) can be reached in both production and staging environments. The sandboxed staging environment has been created to ensure production data integrity.

\subsection{Production Environment}
To access the API in the production environment, the following endpoint has to be used:
\begin{lstlisting}
https://api.ia.utwente.nl/app/lennart/
\end{lstlisting}
Please note that the trailing slash is required.

\subsection{Staging Environment}
To access the API in the staging environment, the following endpoint has to be used:
\begin{lstlisting}
https://staging.inter-actief.utwente.nl/api/
\end{lstlisting}
Please note that the trailing slash is required.

\section{Localization}
As of this version of the API, two languages are supported: Dutch and English. Most data can be translated to either one of these languages, if requested properly.\\
In order to receive localized responses, the Accept-Language HTTP header should be set in accordance with RFC5646, for example:
\begin{lstlisting}
Accept-Language: nl-NL
\end{lstlisting}

\clearpage
\section{JSON-RPC Request}
In order to execute a remote procedure, you must send an HTTP POST request, containing a json dictionary in compliance to the JSON-RPC 2.0 specification\cite{jsonrpc}. This implies that each request dictionary must at least contain the following keys:

\begin{enumerate}
\item[jsonrpc] A String specifying the version of the JSON-RPC protocol. This field MUST be exactly "2.0" in order to use JSON-RPC 2.0 features. When omitted JSON-RPC 1.0 is assumed.
\item[method]
A String containing the name of the method to be invoked.
\item[params]
A Structured value that holds the parameter values to be used during the invocation of the method. If a method does not require any parameters, an empty array MUST be included.
\item[id]
An identifier established by the Client that MUST contain a String or Number.  Numbers SHOULD NOT contain fractional parts.
\end{enumerate}
The `id' and `jsonrpc' fields are ommitted in all examples.

\section{JSON-RPC Response}
After sending a request, a response object will be returned. The response object consists of a json dictionary containing the following keys:
\begin{enumerate}
\item[jsonrpc]
A String specifying the version of the JSON-RPC protocol.
\item[result]
The value of this member is determined by the method invoked on the Server.
\item[error]
This member only exists if an error has occured. The structure of this member is defined in \autoref{sec:errordict}. If no error has occured, this member MAY also be null.
\item[id]
This member contains the value of the id member in the Request Object. If the id could not be parsed due to a parse error, it will be set to null.
\end{enumerate}
The `id' and `jsonrpc' fields are ommitted in all examples.

\clearpage

\section{Device ID}
Some methods may require a deviceId. A deviceId is an unique token, used to identify your device or service. Obtaining a new deviceId can be done through the getDeviceId method as described in \autoref{m:getDeviceId}.

\section{Authentication \& Authorization}
Some methods MAY or MUST be invoked using authentication. In order to make an authenticated call, your application MUST first request an authentication token. This can be done using the getAuthToken method. More information can be found in \autoref{m:getAuthToken}.\\\\
When used, an authentication token MUST be included in the HTTP Authorization header in the following fashion:
\begin{lstlisting}
Bearer some.long.auth.token!%&...
\end{lstlisting}

\subsection{Scopes}
After using the getAuthToken method, which can be found in \autoref{m:getAuthToken}, the token returned will automatically be assigned all available scopes.\\
The following scopes currently exist within the API:
\begin{enumerate}
\item[account] This scope is required to get access to personal data, such as name and student number.
\item[signup] This scope is required to (de-)register for activities.
\item[transaction] This scope is required for transactions, mandates, RFID-cards and direct debits.
\item[education] This scope allows for the creation and reading of educational complaints.
\end{enumerate}
OAuth applications will have to request each of these scopes individually. More information about OAuth can be found in \autoref{subsec:oauth}.

\subsection{OAuth}\label{subsec:oauth}
To be added.

\chapter{Methods}
The API exposes different methods. These methods are all grouped into modules. A module contains the methods involving a specific entity of amelie.

\section{Authentication Module}\label{sec:authmodule}
\subsection{getDeviceId}\label{m:getDeviceId}
\begin{enumerate}
\item[Method] getDeviceId
\item[Description] Requests a new deviceId. Your application SHOULD call this method only once in your apps lifetime, just after its first start, and store the result for further use.
\item[Authentication] (none)
\item[Parameters] (none)
\item[Returns] A string containing a newly assigned deviceId
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getDeviceId", "params":[]}
<-- {"result": "QphLtj#z%Itaceny"}
\end{lstlisting}
\end{enumerate}

\subsection{getAuthToken}\label{m:getAuthToken}
\begin{enumerate}
\item[Method] getAuthToken
\item[Description] Attempts to log in and returns an authentication token.
\item[Authentication] (none)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
    \item[username] The username of the user
    \item[password] The password of the user
    \item[deviceId] The device ID obtained through getDeviceId.
    \end{enumerate}
\item[Returns] A string containing the auth token, or null if the authentication failed.
\item[Errors] UnknownDeviceError: when the device ID was not recognized.
\item[Example]
\begin{lstlisting}
--> {"method":"getAuthToken", "params":["user","pass","deviceId"]}
<-- {"result": "some.long.auth.token!%&..."}
\end{lstlisting}
\end{enumerate}

\clearpage
\subsection{checkAuthToken}
\begin{enumerate}
\item[Method] checkAuthToken
\item[Description] Checks if an auth token is still valid. It is recommended to do this after resuming your app, to see if the token was revoked.
\item[Authentication] (none)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
    \item[token] The authentication token, obtained with getAuthToken
    \end{enumerate}
\item[Returns] true if the token was valid and an user is attached, false otherwise.
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"checkAuthToken", "params":["some.long.auth.token!%&..."]}
<-- {"result": true}
\end{lstlisting}
\end{enumerate}

\subsection{revokeAuthToken}
\begin{enumerate}
\item[Method] revokeAuthToken
\item[Description] Revokes an authentication token.
\item[Authentication] (none)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
    \item[token] The authentication token, obtained with getAuthToken
    \end{enumerate}
\item[Returns] true if the token was successfully revoked, null otherwise.
\item[Errors] NotLoggedInError: If the token was not recognized or already revoked.
\item[Example]
\begin{lstlisting}
--> {"method":"revokeAuthToken", "params":["some.long.auth.token!%&..."]}
<-- {"result": true}
\end{lstlisting}
\end{enumerate}

\clearpage
\subsection{getAuthenticatedApps}
\begin{enumerate}
\item[Method] getAuthenticatedApps
\item[Description] Retrieves the list of authenticated apps for the currently authenticated person.
\item[Authentication] REQUIRED (account)
\item[Parameters] (none)
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[applicationId] The identifier of the application
    \item[applicationName] The name of the application
    \item[expires] The expiration date and time for the token associated with the application (RFC3339)
	\item[scopes] The dictionary of permitted scopes for the application, which MAY include any of the following members:
    \begin{enumerate}
        \item[education] Description of the education authentication scope
        \item[transaction] Description of the transaction authentication scope
        \item[account] Description of the account authentication scope
        \item[signup] Description of the signup authentication scope
        \end{enumerate}
    \end{enumerate}
\item[Errors] NotLoggedInError: If the token was not recognized or already revoked.
\item[Example]
\begin{lstlisting}
--> {"method":"getAutenticatedApps", "params":[]}
<-- {"result": [{
        "applicationId": 1,
        "applicationName": "Legacy getAuthToken API token",
        "expires": "2016-10-26T00:56:14+00:00",
        "scopes": {
            "account": "De App krijgt toegang tot je naam, geboortedatum, studentnummer, machtigingstatus en commissiestatus",
            "signup": "De App kan je in- en uitschrijven voor activiteiten"
        }
     }]}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{Person Module}\label{sec:personmodule}
\subsection{getPersonDetails}
\begin{enumerate}
\item[Method] getPersonDetails
\item[Description] Retrieves details of the currently authenticated person.
\item[Authentication] REQUIRED (account)
\item[Parameters] (none)
\item[Returns] A dictionary containing the following members:
\begin{enumerate}
	\item[name] The full name of this person
    \item[firstName] The first name of this person
    \item[lastName] The last name of this person
    \item[birthdate] The birthdate of this person
    \item[board] true if this person is a board member, false otherwise
    \item[candidateBoard] true if this person is a candidate board member, false otherwise
    \item[member] true if this person is a member, false otherwise
    \item[hasCommittees] true if this member has joined any committees, false otherwise
    \item[hasActivityDirectDebit] true if this person has signed a debit contract, false otherwise
    \item[username] The username of this person, can be empty or null
    \item[studentId] The student ID of this person, can be null
    \item[employeeId] The employee ID of this person, can be null
    \item[email] The email address of this person
    \item[languagePreference] The preferred language for this user, either "nl" or "en"
    \item[imageUrl] The profile image URL for the authenticated user
    \end{enumerate}
\item[Errors] NotLoggedInError: If the token was not recognized or already revoked.
\item[Example]
\begin{lstlisting}
--> {"method":"getPersonDetails", "params":[]}
<-- {"result": {
        "name": "Donald D. Duck",
        "firstName": "Donald",
        "lastName": "Duck",
        "birthdate": "1954-02-19",
        "board": false
        "candidateBoard": false,
        "member": true,
        "hasCommittees": true,
        "hasActivityDirectDebit": true,
        "username": "duckdd",
        "studentId": "s1234567",
        "employeeId": null,
        "email": "d.d.duck@student.utwente.nl",
        "languagePreference": "nl",
        "imageUrl": "https://media.ia.utwente.nl/amelie/pasfoto/s1234567.jpg"
     }}
\end{lstlisting}
\end{enumerate}

\subsection{getPersonCommittees}
\begin{enumerate}
\item[Method] getPersonCommittees
\item[Description] Retrieves a list of committees in which the currently authenticated person has been a member of, or is currently active in.
\item[Authentication] REQUIRED (account)
\item[Parameters] (none)
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
	\item[position] The position of this person in this committee
    \item[end] The date on which this person was last member of this committee, otherwise null
    \item[begin] The date on which this person first joined this committee
    \item[committee] The name of this committee
    \end{enumerate}
\item[Errors] NotLoggedInError: If the token was not recognized or already revoked.
\item[Example]
\begin{lstlisting}
--> {"method":"getPersonCommittees", "params":[]}
<-- {"result": [{
        "position": "Lead Developer Duckstad",
        "end": null,
        "begin": "1954-02-19",
        "committee": "F.C. Duckstad"
     }]}
\end{lstlisting}
\end{enumerate}

\clearpage
\subsection{getPersonMembership}
\begin{enumerate}
\item[Method] getPersonMembership
\item[Description] Retrieves the active membership details of the currently authenticated person
\item[Authentication] REQUIRED (account)
\item[Parameters] (none)
\item[Returns] A dictionaries containing the following members:
\begin{enumerate}
	\item[type] The type of membership
    \item[year] The year of the active membership
    \item[hasEnded] Value indicating whether the membership has ended, either true or false
    \item[payment] Details regarding the payment of this membership
    \begin{enumerate}
        \item[amount] The cost of the active membership
        \item[date] Date on which the payment was processed
        \item[method] Details regarding the payment method of the active membership
        \begin{enumerate}
            \item[name] Name of the payment method
            \item[description] Description of the payment method
            \end{enumerate}
        \end{enumerate}
    \end{enumerate}
\item[Errors] NotLoggedInError: If the token was not recognized or already revoked.
\item[Example]
\begin{lstlisting}
--> {"method":"getPersonMembership", "params":[]}
<-- {"result": {
        "type": "inbitween",
        "year": 2016,
        "hasEnded": false
        "payment": {
            "amount": "4.25",
            "date": "2016-07-01",
            "method": {
                "name": "Stress",
                "description": "Bij een lidmaatschap van inbitween loopt de betaling via Stress"
            }
        }
     }}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{Push Module}\label{sec:pushmodule}
\subsection{storePushToken}
\begin{enumerate}
\item[Method] storePushToken
\item[Description] Stores a push token (or URI for MPNS).
\item[Authentication] OPTIONAL
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[deviceId] The deviceId, obtaind with getDeviceId
  	\item[pushToken] The push token or URI, received from the push supplier
	\item[agent] An descriptive string for your device
	\item[language] The language code of the device, preferably RFC5646.
    \end{enumerate}
\item[Returns] true if the token was successfully stored, otherwise null
\item[Errors] UnknownDeviceError: when the device ID was not recognized.
\item[Example]
\begin{lstlisting}
--> {"method":"storePushToken", "params":["deviceId", "pushToken", "Bob's iPhone @ iOS 8.0", "nl-NL"]}
<-- {"result": true}
<-- {"result": null}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{News Module}
\subsection{getNewsStream}
\begin{enumerate}
\item[Method] getNewsStream
\item[Description] Retrieves a list of recent news items and Twitter messages.
\item[Authentication] (none)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[offset] The first item in the list to return
	\item[length] The amount of items to return
    \end{enumerate}
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[id] The identifier for this news item
    \item[title] The title of this item
	\item[category] The category of this news item
    \item[imageUrl] An URL of a thumbnail for this item
    \item[date] The publication date of this item (RFC3339)
    \item[source] The source of this item
    \item[breakout] true if this item contains its own header, OPTIONAL
    \end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getNewsStream", "params":[0,1]}
<-- {"result": [{
        "id": 430,
        "title": "Read our latest blog post!",
        "category": "twitter",
        "imageUrl": "https://pbs.twimg.com/profile_image.png",
        "date": "2014-07-07T18:56:50+00:00",
        "source": "StudyTour",
        "breakout": false
    }]}
\end{lstlisting}
\end{enumerate}

\clearpage
\subsection{getNewsDetailed}
\begin{enumerate}
\item[Method] getNewsDetailed
\item[Description] Retrieves details of a news item, including its content.
\item[Authentication] (none)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[source] The source of the requested item
	\item[id] The id of the requested item
    \end{enumerate}
\item[Returns] A Dictionary containing the following fields:
\begin{enumerate}
    \item[id] The identifier for this news item
    \item[title] The title of this item
	\item[category] The category of this news item
    \item[imageUrl] An URL of a thumbnail for this item
    \item[date] The publication date of this item (RFC3339)
    \item[source] The source of this item
    \item[breakout] true if this item contains its own header, OPTIONAL
    \item[author] the Author of this news item
    \item[content] The HTML content of this news item
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getNewsDetailed", "params":["StudyTour", 430]}
<-- {"result": {
        "id": 430,
        "title": "Read our latest blog post!",
        "category": "twitter",
        "imageUrl": "https://pbs.twimg.com/profile_image.png",
        "date": "2014-07-07T18:56:50+00:00",
        "source": "StudyTour",
        "breakout": false,
        "author": "StudyTour"
        "content": "<html><!--html contents--></html>"
    }}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{Narrowcasting Module}
\subsection{getBanners}
\begin{enumerate}
\item[Method] getBanners
\item[Description] Retrieves a list of sponsored banners.
\item[Authentication] (none)
\item[Parameters] (none)
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[id] The ID of the banner
    \item[name] The title of the banner
	\item[image] An URL to the image of an banner
    \end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getBanners", "params":[]}
<-- {"result": [{
        "id": 15,
        "name": "Super awesome company, work here!",
        "image": "https://url.to/banner.png"
    }]}
\end{lstlisting}
\end{enumerate}
\clearpage

\subsection{getNews}
\begin{enumerate}
\item[Method] getNews
\item[Description] Retrieves a list of recent news articles.
\item[Authentication] (none)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
    \item[amount] The amount of most recent items to return
    \item[render\_markdown] A boolean that indicates whether you want to render markdown in the introduction and content to HTML, OPTIONAL, default false.
    \end{enumerate}
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[id] The id of this item
    \item[title] The title of this item
    \item[url] The url of this item
	\item[publicationDate] The publication date of this news item. (RFC3339)
    \item[introduction] A short introduction to this news article
    \item[content] The content of this news article
    \end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getNews", "params":[1]}
<-- {"result": [{
        "title": "Read our latest blog post!",
        "url": "/nieuws/304/2016/10/31/boeken-lenen-bij-inter-actief/",
        "id": 304,
        "publicationDate": "2014-07-04T12:29:06Z",
        "introduction": "lalalala this is a _short_ intro.. Lees meer...",
        "content": "Long long story."
    }]}

--> {"method":"getNews", "params":[1, true]}
<-- {"result": [{
        "title": "Read our latest blog post!",
        "url": "/nieuws/304/2016/10/31/boeken-lenen-bij-inter-actief/",
        "id": 304,
        "publicationDate": "2014-07-04T12:29:06Z",
        "introduction": "lalalala this is a <i>short</i> intro.. Lees meer...",
        "content": "Long long story."
    }]}
\end{lstlisting}
\end{enumerate}

\clearpage

\subsection{getTelevisionPromotions}
\begin{enumerate}
\item[Method] getTelevisionPromotions
\item[Description] Retrieves a list of promoted events.
\item[Authentication] (none)
\item[Parameters] (none)
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[title] The title of the banner
	\item[image] An URL to the image of an banner
    \item[signup] True if it is possible to sign up for this activity, OPTIONAL
    \item[signupStart] The start date of the signup period, OPTIONAL (RFC3339)
    \item[signupStop] The signup deadline, OPTIONAL (RFC3339)
    \item[signupMaximum] Maximum allowed attendees, OPTIONAL
    \item[signupAvailable] Amount of current attendees, OPTIONAL
    \end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getTelevisionPromotions", "params":[]}
<-- {"result": [{
        "image": "https://url.to/promotion.png",
        "title": "Water Skiing!",
        "signupStart":"2014-07-03T18:56:50+00:00",
        "signupStop":"2014-07-08T18:56:50+00:00",
        "signupMaximum":40,
        "signupAvailable":12
    }]}
\end{lstlisting}
\end{enumerate}
\clearpage

\subsection{getHistoricActivitiesWithPictures}
\begin{enumerate}
\item[Method] getHistoricActivitiesWithPictures
\item[Description] Retrieves a list of a number of random activities between two dates that have pictures
\item[Authentication] OPTIONAL
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
    \item[begin] The minimal end date, RFC3339 (inclusive)
    \item[end] The maximal begin date, RFC3339 (exclusive)
    \item[amount] The amount of activities
    \end{enumerate}
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[id] The identifier for this activity
    \item[title] The title of this activity
    \item[location] The location of this event.
    \item[beginDate] The starting date and time of this event (RFC3339)
    \item[endDate] The end date and time of this event (RFC3339)
    \item[thumbnail] An URL to the thumbnail image for this event.
    \item[source]: The source of this event (always "inter-actief")
    \item[pictures]: An array of URL's to the individual pictures of this event.
    \item[url]: The URL to the pictures page of this event.
    \end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getHistoricActivitiesWithPictures", "params":["2014-07-01T00:00:00+02:00", "2014-07-31T23:59:59+02:00", 2]}
<-- {"result": [{
        "id": 1337
        "title": "Awesome Activity!",
        "location": "SmartXP",
        "beginDate": "2014-07-01T18:56:50+00:00",
        "endDate": "2014-07-01T20:56:50+00:00",
        "thumbnail": "https://url.to/image.png",
        "source": "inter-actief",
        "pictures": ["https://url.to/image.png", ...],
        "url": "/activiteiten/1337/fotos"
    }]}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{Committee Module}
\subsection{getCommitteeStream}
\begin{enumerate}
\item[Method] getCommitteeStream
\item[Description] Retrieves a list of all committees.
\item[Authentication] (none)
\item[Parameters] (none)
\item[Returns] A dictionary of arrays of dictionaries containing the following members:
\begin{enumerate}
    \item[id] The identifier for this committee
    \item[name] The name of this committee
    \item[imageUrl] An URL of a thumbnail for this committee
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getCommitteeStream", "params":[]}
<-- {"result": {"ICT": [{
        "id": 12,
        "name": "AppCie",
        "imageUrl": "https://url.to/image.png"
    }], "Travel":[...]
    }}
\end{lstlisting}
\end{enumerate}
\clearpage

\subsection{getCommitteeDetailed}
\begin{enumerate}
\item[Method] getCommitteeDetailed
\item[Description] Retrieves details of committee, including its members
\item[Authentication] OPTIONAL
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[id] The id of the requested item
    \end{enumerate}
\item[Returns] A Dictionary containing the following fields:
\begin{enumerate}
    \item[name] The name of this committee
    \item[imageUrl] An URL of a logo for this committee
    \item[founded] The  date of this committee was founded (RFC3339)
    \item[description] A description of this committee
    \item[email] the email adress of this committee
    \item[members] an array of dictionaries representing members of this committee:
	\begin{enumerate}
        \item[name] The full name of this member
        \item[firstName] The first name of this member
        \item[lastName] The family name of this member
        \item[function] The function of this member within the committee
        \item[phone] The phone number of this member, otherwise null*
        \item[email] The email address of this member, otherwise null*
        \item[] *Requires an authenticated call and being a member this committee
        \end{enumerate}
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getCommitteeDetailed", "params":[12]}
<-- {"result": {
        "id": 12,
        "name": "AppCie",
        "imageUrl": "https://pbs.twimg.com/profile_image.png",
        "founded": "2011-07-07T18:56:50+00:00",
        "description": "This committee develops and mantains the IApp",
        "email": "nospam@inter-actief.net",
        "members": [{
            	"name":"Donald Duck",
                "firstName": "Donald",
                "lastName": "Duck",
                "function": "Quacker",
                "phone": null,
                "email": null
        }}}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{Company Module}
\subsection{getCompanyStream}
\begin{enumerate}
\item[Method] getCompanyStream
\item[Description] Retrieves a list of partnered companies.
\item[Authentication] (none)
\item[Parameters] (none)
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[id] The identifier for this news item
    \item[name] The title of this item
    \item[imageUrl] An URL of a logo for this company
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getCompanyStream", "params":[]}
<-- {"result": [{
        "id": 28,
        "name": "University of Twente",
        "imageUrl": "https://pbs.twimg.com/profile_image.png"
    }]}
\end{lstlisting}
\end{enumerate}


\subsection{getCompanyDetailed}
\begin{enumerate}
\item[Method] getCompanyDetailed
\item[Description] Retrieves company details, including its promotional content.
\item[Authentication] (none)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
    \item[id] The id of the requested item
    \end{enumerate}
\item[Returns] A Dictionary containing the following fields:
\begin{enumerate}
    \item[name] The name of this company
    \item[description] The HTML content of this news item
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getCompanyDetailed", "params":[28]}
<-- {"result": {
        "name": "University of Twente",
        "description": "<html><!--html contents--></html>"
    }}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{Activity Module}
\subsection{getActivityStream}
\begin{enumerate}
\item[Method] getActivityStream
\item[Description] Retrieves a list of activities.
\item[Authentication] OPTIONAL
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[begin] The minimal end date, RFC3339 (inclusive)
    \item[end] The maximal begin date, RFC3339 (exclusive)
    \end{enumerate}
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[id] The identifier for this activity
    \item[title] The title of this activity
    \item[beginDate] The starting date and time of this activity (RFC3339)
    \item[endDate] The end date and time of this activity (RFC3339)
    \item[signup] either "required" or "nosignup"
    \item[signedUp] true if logged in and signed up, otherwise false
    \item[imageUrl] The URL of the activity image or icon, otherwise null
    \item[location] The location of this activity
    \item[source] The provider of this activity
    \item[signupAvailable] true if it is possible to sign up, otherwise false
    \item[signupStart] The date and time when registration opens (RFC3339), otherwise null
    \item[signupStop] The date and time when registration closes (RFC3339), otherwise null
    \item[url] The URL for this activity
	\end{enumerate}
\item[Errors] (none)
\clearpage
\item[Example]
\begin{lstlisting}
--> {"method":"getActivityStream", "params":["2014-07-01T00:00:00+02:00", "2014-07-31T23:59:59+02:00", "token"]}
<-- {"result": [{
        "id": 28,
        "title": "Project Evening",
        "beginDate": "2014-07-02T018:00:00+02:00",
        "endDate": "2014-07-03T08:00:00+02:00",
        "signup": "required",
        "signedUp": false,
        "imageUrl": "https://media.ia.utwente.nl/amelie/activiteiten/icoon/logo.png",
        "location": "Carre 2K",
        "source": "inter-actief",
        "signupAvailable": true,
        "signupStart": "2014-07-02T018:00:00+02:00",
        "signupStop": "2014-07-02T018:00:00+02:00",
        "url": "/activiteiten/28/"
    }, {...}, {...}]}
\end{lstlisting}
\end{enumerate}

\clearpage

\subsection{getActivityDetailed}
\begin{enumerate}
\item[Method] getActivityDetailed
\item[Description] Retrieves details of an event, including its signup options.
\item[Authentication] OPTIONAL
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[id] The id of the requested item
    \end{enumerate}
\item[Returns] A Dictionary containing the following fields:
\begin{enumerate}
    \item[id] The identifier for this news item
    \item[title] The title of this item
    \item[beginDate] The starting date and time of this event (RFC3339)
    \item[endDate] The end date and time of this event (RFC3339)
    \item[signup] either "required" or "nosignup"
    \item[signups] The amount of attendees
    \item[availability] The maximum amount of attendees, 0 if no maximum
    \item[price] The base costs for attending this activity, or total costs when signed up, 0 if no price
    \item[pictures] An array of URLs to pictures for this activity, or an empty array
    \item[description] A description of this event.
    \item[location] The location of this event
    \item[signupAvailable] true if it is possible to sign up, otherwise false
    \item[signedUp] true if logged in and signed up, false otherwise* OPTIONAL
    \item[resignAvailable] true if it is possible to sign out, does not depend upon signup state* OPTIONAL
    \item[options] an array of dictionaries representing signup options:
	\begin{enumerate}
        \item[id] the ID of this option
        \item[type] either "question", "checkbox" or "selectbox"
        \item[question] the description of this option
        \item[price] additional costs, only present for the checkbox type
        \item[required] true if this question or selectbox requires an answer.
        \item[choices] array of dictionaries representing choices for the selectbox:
    	\begin{enumerate}
        	\item[id] the ID of this choice
            \item[dish] the dish name of this choice
            \item[restaurant] the restaurant name of this choice
            \item[price] the additional costs of this choice
            \end{enumerate}
        \end{enumerate}
    \item[] *Requires an authenticated call and an activity with sign ups. Otherwise this member is not present.
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getActivityDetailed", "params":[28, "token"]}
<-- {"result": {
        "id": 28,
        "title": "Project Evening",
        "begin-date": "2014-07-02T018:00:00+02:00",
        "end-date": "2014-07-03T08:00:00+02:00",
        "signup": "required",
        "signups": 12,
        "availability": 50,
        "price": 50.00,
        "pictures": ["http://pic1", "http://pic2"],
        "description": "Super cool awesome activity with pizza!",
        "location": "Educafe",
        "deadline": "2014-07-02T014:00:00+02:00",
        "signedup": false,
        "options": [{
            	"id":123,
                "type": "selectbox",
                "question": "what kind of pizza? (Joe Pizza)",
                "required": true,
                "choices": [{"id":87, "dish": "Hawaii", "restaurant": "Joe Pizza", "price":6.0},
                    {"id":88, "dish": "Salami", "restaurant": "Joe Pizza", "price":7.0}]
            },{
            	"id":124,
                "type": "checkbox",
                "question": "Super priority delivery",
                "price": 2.0
            },{
            	"id":125,
                "type": "question",
                "question": "what's your mothers maiden name?",
                "required": true
            },{...}]
    }}
\end{lstlisting}
\end{enumerate}


\clearpage
\subsection{getLatestActivitiesWithPictures}
\begin{enumerate}
\item[Method] getLatestActivitiesWithPictures
\item[Description] Retrieves a list of most recent activities that have pictures.
\item[Authentication] OPTIONAL
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[amount] The amount of activities
    \end{enumerate}
\item[Returns] An array of dictionaries containing the following fields:
\begin{enumerate}
    \item[beginDate] The starting date and time of this event (RFC3339)
    \item[thumbnail] The thumbnail representing the collection of pictures
    \item[endDate] The end date and time of this event (RFC3339)
    \item[title] The title of this item
    \item[location] The location of this event
    \item[source] The provider of this activity
    \item[pictures] An array of URLs to pictures for this activity, or an empty array
    \item[id] The identifier for this news item
    \item[url] The URL for this activity
    \end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getLatestActivitiesWithPictures", "params":[50]}
<-- {"result": [{
        "id": 28,
        "title": "Project Evening",
        "beginDate": "2014-07-02T018:00:00+02:00",
        "endDate": "2014-07-03T08:00:00+02:00",
        "location": "Carre 2K",
        "source": "inter-actief",
        "url": "/activiteiten/28/",
        "thumbnail": ""
        "pictures": []
    }, {...}, {...}]}
\end{lstlisting}
\end{enumerate}


\clearpage
\subsection{getUpcomingActivities}
\begin{enumerate}
\item[Method] getUpcomingActivities
\item[Description] Retrieves a list of upcoming activities, nearest first
\item[Authentication] OPTIONAL
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[amount] The amount of activities
    \end{enumerate}
\item[Returns] See getActivityStream
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getUpcomingActivities", "params":[50]}
\end{lstlisting}
\end{enumerate}

\clearpage

\subsection{activitySignup}
\begin{enumerate}
\item[Method] activitySignup
\item[Description] Marks the current user as attendee to an activity
\item[Authentication] REQUIRED (signup)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[id] The ID of the activity
    \item[price] The calculated costs, used for consistency checks (decimal)
    \item[options] An array of dictionaries representing the selected options. Unanswered options should be omitted. All options with the "required" attribute MUST be present:
	\begin{enumerate}
    	\item[id] The ID of the option
        \item[value] The value of the option; A string for a "question", boolean for "checkbox", integer for "selectbox".
        \end{enumerate}
    \end{enumerate}
\item[Returns] true if successfully signed up, otherwise an error
\item[Errors]
	NotLoggedInError: Invalid or no authentication token received \\
	SignupError: User could not be signed up. See the error message for more details. \\
    MissingOptionError: Occurs when not all required options were present.
\item[Example]
\begin{lstlisting}
--> {"method":"activitySignup", "params":[
        28,
        56.0,
        [{"id":123, "value":87}, {"id":125, "value":"Wortel"}]]}
<-- {"result": true}
\end{lstlisting}
\end{enumerate}


\subsection{activityRevokeSignup}
\begin{enumerate}
\item[Method] activityRevokeSignup
\item[Description] Unmarks the current user as an attendee to an activity
\item[Authentication] REQUIRED (signup)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[id] The ID of the activity
    \end{enumerate}
\item[Returns] true if successfully revoked, otherwise an error
\item[Errors]
	NotLoggedInError: Invalid or no authentication token received \\
	SignupError: User could not be signed up. See the error message for more details. \\
    MissingOptionError: Occurs when not all required options were present.
\item[Example]
\begin{lstlisting}
--> {"method":"activityRevokeSignup", "params":[28]}
<-- {"result": true}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{Education Module}
\subsection{getComplaintStream}
\begin{enumerate}
\item[Method] getComplaintStream
\item[Description] Retrieves a list of complaints.
\item[Authentication] REQUIRED (education)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[begin] The minimal end date, RFC3339 (inclusive)
    \item[end] The maximal begin date, RFC3339 (exclusive)
    \end{enumerate}
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[id] The identifier for this complaint
    \item[dateTime] The submission date and time of this complaint (RFC3339)
    \item[type] The type of this complaint
    \item[summary] The summary of this complaint
    \item[remark] The content of the complaint
    \item[supporters] The amount of supporters for this complaint (includes the original reporter)
    \item[hasSupported] true if the authenticated person has supported this complaint, otherwise false
    \item[course] The course concerning this complaint, can be null
    \item[subject] The subject concerning the course of this complaint, can be null
    \item[year] The first year of the academic year in which the course was given, can be null
    \item[period] The period of the academic year in which the course was given, can be null
	\end{enumerate}
\item[Errors] InvalidParamsError
\item[Example]
\begin{lstlisting}
--> {"method":"getComplaintStream", "params":["2014-07-01T00:00:00+02:00", "2014-07-31T23:59:59+02:00"]}
<-- {"result": [{
        "id": 28,
        "dateTime": "2014-07-02T018:00:00+02:00",
        "type": "Overig",
        "summary": "So many bugs, so many...,
        "remark": "Description of the complaint",
        "supporters": 42,
        "hasSupported": false,
        "course": "Computer Systems",
        "subject": "Programming",
        "year": 2016,
        "period": "K2"
    }, {...}, {...}]}
\end{lstlisting}
\end{enumerate}


\clearpage
\subsection{addComplaintSupport}
\begin{enumerate}
\item[Method] addComplaintSupport
\item[Description] Adds support of the authenticated person to a specific complaint.
\item[Authentication] REQUIRED (education)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[id] The identifier of any existing complaint
    \end{enumerate}
\item[Returns] true if successful, otherwise false
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"addComplaintSupport", "params":[42]}
<-- {"result": true}
\end{lstlisting}
\end{enumerate}

\subsection{removeComplaintSupport}
\begin{enumerate}
\item[Method] removeComplaintSupport
\item[Description] Removes support of the authenticated person of a specific complaint.
\item[Authentication] REQUIRED (education)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[id] The identifier of any existing complaint
    \end{enumerate}
\item[Returns] true if successful, otherwise false
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"removeComplaintSupport", "params":[42]}
<-- {"result": true}
\end{lstlisting}
\end{enumerate}


\clearpage
\subsection{getComplaintCreationFields}\label{m:getComplaintCreationFields}
\begin{enumerate}
\item[Method] getComplaintCreationFields
\item[Description] Retrieves information regarding the various fields required for creating a new complaint.
\item[Authentication] REQUIRED (education)
\item[Parameters] (none)
\item[Returns] A dictionaries containing the following members:
\begin{enumerate}
    \item[types] An array of strings, each being a valid complaint type
    \item[periods] An array of strings, each being a valid period
    \item[courses] An array of dictionary objects, each item being a valid course
    \begin{enumerate}
        \item[id] The identifier of this course
        \item[name] The name of this course
        \item[courseCode] The code of this course
        \end{enumerate}
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getComplaintCreationFields", "params":[]}
<-- {"result": {
        "types": ["Nakijken", "Faciliteiten", "Informatie", "Overig"],
        "periods": ["K1", "K2", "K3", "K4", "S1", "S2"],
        "courses": [{
            "id": 42,
            "name": "Some fancy course name",
            "courseCode": 201600000
        }, {...}, {...}]
    }}
\end{lstlisting}
\end{enumerate}


\clearpage
\subsection{createComplaint}
\begin{enumerate}
\item[Method] createComplaint
\item[Description] Creates a new complaint about a specific topic.
\item[Authentication] REQUIRED (education)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[type] The type of the complaint*
    \item[courseId] The id of the course concerning this complaint*
    \item[summary] A short summary of the complaint
    \item[remark] The description of the complaint
    \item[public] Boolean value indicating whether to include the complaint in the public listing
    \item[anonymous] Boolean value indicating whether to restrict reporter identity to the board
    \item[subject] The subject concerning the course of this complaint
    \item[year] The first year of the academic year in which the course was given
    \item[periodId] The period of the academic year in which the course was given*
    \item[] *Valid values for these members can be requested with the getComplaintCreationFields method found in \autoref{m:getComplaintCreationFields}.
    \end{enumerate}
\item[Returns] true if successful, otherwise false
\item[Errors] InvalidParamsError
\item[Example]
\begin{lstlisting}
--> {"method":"createComplaint", "params":["Overig", 201600000, "summary", "description", true, false, "subject", 2016, "K3"]}
<-- {"result": true}
\end{lstlisting}
\end{enumerate}


\clearpage
\section{Transaction Module}
\subsection{getRfidCards}
\begin{enumerate}
\item[Method] getRfidCards
\item[Description] Retrieves a list of RFID-cards attributed to the authenticated person.
\item[Authentication] REQUIRED (transaction)
\item[Parameters] (none)
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[isActivated] Boolean value indicating the activation status of this card
    \item[code] The RFID-code associated with this card
    \item[type] The type of this card
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getRfidCards", "params":[]}
<-- {"result": [{
        "isActivated": true,
        "code": "00,0a:00:00:00",
        "type": "Mifare 1K (Collegekaart/Gebouwpas)"
    }, {...}, {...}]}
\end{lstlisting}
\end{enumerate}


\subsection{getDirectDebits}
\begin{enumerate}
\item[Method] getDirectDebits
\item[Description] Retrieves a list of direct debits associated with the authenticated person.
\item[Authentication] REQUIRED (transaction)
\item[Parameters] (none)
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[date] The date of the direct debit
    \item[description] A description of the direct debit
    \item[amount] The amount of money requested by the direct debit
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getDirectDebits", "params":[]}
<-- {"result": [{
        "date": "2017-02-14",
        "description": "A very informative description",
        "amount": "12.00"
    }, {...}, {...}]}
\end{lstlisting}
\end{enumerate}


\clearpage
\subsection{getMandates}
\begin{enumerate}
\item[Method] getMandates
\item[Description] Retrieves a list of mandates associated with the authenticated person.
\item[Authentication] REQUIRED (transaction)
\item[Parameters] (none)
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[accountHolder] The name of the person holding the account
    \item[reference] The reference id of the mandate
    \item[beginDate] The start date of the mandate, either ISO format or "old"
    \item[endDate] The end date of the mandate, can be null
    \item[iban] The IBAN associated with the mandate
    \item[type] The type of mandate
	\end{enumerate}
\item[Errors] (none)
\item[Example]
\begin{lstlisting}
--> {"method":"getMandates", "params":[]}
<-- {"result": [{
        "accountHolder": "D. D. Duck",
        "endDate": null,
        "reference": "IA-MNDT-00000000",
        "type": "Consumpties, activiteiten en overige",
        "iban": "XX00XXXX0000000000",
        "beginDate": "2017-01-26"
    }, {...}, {...}]}
\end{lstlisting}
\end{enumerate}


\clearpage
\subsection{getTransactions}
\begin{enumerate}
\item[Method] getTransactions
\item[Description] Retrieves a list of transactions associated with the authenticated person.
\item[Authentication] REQUIRED (transaction)
\item[Parameters] This method accepts the following parameters:
\begin{enumerate}
	\item[begin] The minimal end date, RFC3339 (inclusive)
    \item[end] The maximal begin date, RFC3339 (exclusive)
    \end{enumerate}
\item[Returns] An array of dictionaries containing the following members:
\begin{enumerate}
    \item[person] The name of the person who performed the transaction
    \item[description] The description of the transaction
    \item[date] The date of the transaction (RFC3339)
    \item[amount] The amount of money reduced by the transaction, can be negative
	\end{enumerate}
\item[Errors] InvalidParamsError
\item[Example]
\begin{lstlisting}
--> {"method":"getTransactions", "params":["2014-07-01T00:00:00+02:00", "2014-07-31T23:59:59+02:00"]}
<-- {"result": [{
        "person": "D. D. Duck",
        "description": "A very bright description",
        "date": "2014-07-02T018:00:00+02:00",
        "amount": "5.00"
    }, {...}, {...}]}
\end{lstlisting}
\end{enumerate}


\begin{thebibliography}{9}

\bibitem{jsonrpc}
	JSON-RPC Working Group (2010), JSON-RPC 2.0 specification.\\ Available at http://www.jsonrpc.org/specification

\end{thebibliography}


\appendix
\chapter{The Error object}\label{sec:errordict}
An Error object has the following fields\cite{jsonrpc}:
\begin{enumerate}
\item[code]
A Number that indicates the error type that occurred.
This MUST be an integer.
\item[message]
A String providing a short description of the error.
The message SHOULD be limited to a concise single sentence.
\item[data]
A value that contains additional information about the error. The value of this member is defined by the Server, this member MAY be omitted.
\end{enumerate}


\section{Known Error Codes}
\begin{table}[hb]
\centering
\begin{tabular}{| r | l | l |}
\hline
\textbf{Error Code} & \textbf{Name} & \textbf{Description} \\
\hline
406 & UnknownDeviceError & The DeviceId was not recognized.\\
403 & NotLoggedInError & Not logged in / The token was not recognized.\\
412 & SignupError & Could not sign up for event. See message.\\
\hline
500 & OtherError &An unexpected error occured, see error details. \\
-32700 & ParseError & An error occurred while parsing the JSON input.\\
-32600 & InvalidRequestError & The received JSON is not a valid JSON-RPC Request.\\
-32601 & MethodNotFoundError & The requested remote-procedure does not exist.\\
-32602 & InvalidParamsError & Invalid method parameters.\\
-32603 & ServerError& Internal JSON-RPC error.\\
\hline
\end{tabular}
\caption{Overview of different errors.}
\end{table}

\end{document}